# 📝 テストデータ生成機能実装指示書（T9） - ラビット＋準同型マスキング暗号プロセッサ 🔐

> **ドキュメント種別: 実装指示書**

## 🌟 タスク進捗状況

タスク実装フェーズの進捗:

- 🔄 **フェーズ 1**: 基盤ユーティリティ実装 [**現在作業中**]
- ⏳ **フェーズ 2**: セキュリティ対策基盤実装 [予定]
- ⏳ **フェーズ 3**: 三暗号方式コア実装 [予定]
- ⏳ **フェーズ 4**: 融合機能と変換システム実装 [予定]
- ⏳ **フェーズ 5**: データ形式とインターフェース実装 [予定]
- ⏳ **フェーズ 6**: 検証とパフォーマンス最適化 [予定]

### 📋 現在の実装フェーズ: `フェーズ1: 基盤ユーティリティ実装`

**現在のタスク**: T9（テストデータ生成機能実装）
**進捗状況**: T1-T8 完了 → **T9 実装中** → T10-T115 未着手

**注**: 各タスクは独立して実装・完了させてください。

### 🎯 タスク範囲（T9: テストデータ生成機能実装）

**実装すべきもの**:

- ✅ `tests/test_utils/generators/random_data.py`
- ✅ `tests/test_utils/generators/structured_data.py`
- ✅ `tests/test_utils/generators/edge_cases.py`
- ✅ 関連するテスト

**実装してはいけないもの**:

- ❌ `tests/test_utils/analyzers/*.py`（次のタスク T10）
- ❌ 他の機能（T10 以降のタスク）

**実装がベストプラクティスに反する可能性がある場合**: 作業を即時停止し、問題を報告してください。

## 📝 課題の詳細

### 🎯 タスク概要

本タスク（T9）ではテストデータ生成機能を実装します。ラビット+準同型マスキング暗号プロセッサのテストに必要な様々なデータを生成する機能群を構築します。すべてのテストケースで使用できる高品質なテストデータを提供し、テスト基盤（T8）と連携してプロジェクト全体の品質を担保します。

**本タスク（T9）の作業カウント**:

- 📝 **実装作業**: 12 件

  - ランダムデータ生成機能: 4 関数
  - 構造化データ生成機能: 4 関数
  - エッジケース生成機能: 4 関数

- 🧪 **テスト作業**: 3 件

  - ランダムデータ生成機能テスト
  - 構造化データ生成機能テスト
  - エッジケース生成機能テスト

- ✅ **完了条件**: 25 項目
  - 実装完了条件: 5 項目
  - 機能完了条件: 5 項目
  - テスト完了条件: 5 項目
  - ドキュメント完了条件: 5 項目
  - 納品物件検証条件: 5 項目

### 🔍 背景と目的

ラビット+準同型マスキング暗号プロセッサの品質と堅牢性を保証するためには、様々な条件下での動作を検証する必要があります。テストデータ生成機能は、システムの各コンポーネントやエンドツーエンドテストのための多様で再現可能なテストデータを提供します。

このタスクはフェーズ 1 の基盤ユーティリティ実装において、テスト基盤（T8）と連携して動作する重要なコンポーネントです。生成されるテストデータは、単体テストから統合テスト、セキュリティテストまで、すべてのテストレベルで利用されます。特に、暗号処理の正確性や安全性を検証するための特殊なデータパターンの生成は、本プロジェクトの品質保証において極めて重要です。

### 📊 要件仕様

1. ランダムなバイト列、テキスト、ファイルなど、様々な形式のデータを生成できること
2. 構造化された JSON、CSV などの形式データを生成できること
3. 境界値、空データ、大容量データなどのエッジケースを生成できること
4. 量子乱数生成システム（T5-T7）と連携して高品質な乱数を利用できること
5. 再現可能なテストデータを生成するためのシード指定機能を持つこと
6. 生成したデータを検証するための検証用データも同時に提供できること
7. テスト基盤（T8）と連携して、自動テスト実行時に必要なデータを提供できること
8. 生成したデータがファイルシステムに保存できること

### 🛠️ 実装内容概要

テストデータ生成機能として、以下の 3 つの主要機能を実装します：

1. **ランダムデータ生成機能**: 様々なタイプのランダムデータを生成する機能
2. **構造化データ生成機能**: 特定の構造を持つデータを生成する機能
3. **エッジケース生成機能**: テスト境界条件のためのエッジケースデータを生成する機能

### 📋 実装内容詳細

#### 1. ランダムデータ生成機能（4 つの関数）

```python
def generate_random_bytes(size: int, seed: Optional[int] = None) -> bytes:
    """
    指定されたサイズのランダムなバイト列を生成する

    Args:
        size: 生成するバイト列のサイズ（バイト単位）
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        ランダムなバイト列

    実装詳細:
    1. 量子乱数生成モジュール（T5）が利用可能な場合はそれを使用
    2. 利用できない場合は標準の乱数生成器をフォールバックとして使用
    3. シードが指定された場合は、再現可能な乱数列を生成
    4. シードが指定されていない場合は、完全にランダムなバイト列を生成
    5. サイズが0以下の場合は ValueError を発生
    """
    pass

def generate_random_text(length: int, char_set: str = None, seed: Optional[int] = None) -> str:
    """
    指定された長さのランダムなテキストデータを生成する

    Args:
        length: 生成するテキストの長さ（文字数）
        char_set: 使用する文字セット（デフォルトはアルファベット、数字、一般的な記号）
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        ランダムなテキスト文字列

    実装詳細:
    1. char_set が指定されていない場合はデフォルトの文字セットを使用
    2. 量子乱数に基づいて文字をランダムに選択
    3. マルチバイト文字（UTF-8）を適切に処理
    4. シードが指定された場合は、再現可能なテキストを生成
    5. 長さが0以下の場合は ValueError を発生
    """
    pass

def generate_random_numbers(count: int, min_value: float = 0, max_value: float = 1,
                           as_integers: bool = False, seed: Optional[int] = None) -> List[Union[int, float]]:
    """
    指定された範囲と数のランダムな数値データを生成する

    Args:
        count: 生成する数値の数
        min_value: 最小値
        max_value: 最大値
        as_integers: 整数として生成する場合はTrue、浮動小数点として生成する場合はFalse
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        ランダムな数値のリスト

    実装詳細:
    1. 指定された範囲内でランダムな数値を生成
    2. as_integers がTrueの場合は整数値を生成、そうでない場合は浮動小数点値を生成
    3. 量子乱数生成モジュールを活用して高品質な乱数を生成
    4. シードが指定された場合は、再現可能な数値列を生成
    5. countが0以下の場合はValueErrorを発生
    """
    pass

def generate_random_file(filepath: str, size: int, text_mode: bool = False,
                        seed: Optional[int] = None) -> str:
    """
    指定されたサイズのランダムなファイルを生成する

    Args:
        filepath: 生成するファイルのパス
        size: 生成するファイルのサイズ（バイト単位）
        text_mode: テキストモードで生成する場合はTrue、バイナリモードで生成する場合はFalse
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成したファイルの絶対パス

    実装詳細:
    1. text_modeがTrueの場合はランダムなテキストファイルを生成
    2. text_modeがFalseの場合はランダムなバイナリファイルを生成
    3. 指定されたパスにファイルを書き込み
    4. 正確に指定されたサイズになるようにデータを調整
    5. ファイル生成に失敗した場合は適切な例外を発生
    6. 生成したファイルの絶対パスを返す
    """
    pass
```

#### 2. 構造化データ生成機能（4 つの関数）

```python
def generate_structured_json(structure: Dict[str, Any], depth: int = 3,
                            width: int = 5, seed: Optional[int] = None) -> Dict[str, Any]:
    """
    構造化されたJSONデータを生成する

    Args:
        structure: 生成するJSONの構造テンプレート
        depth: ネストの最大深さ
        width: 各レベルでの最大要素数
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成されたJSON互換の辞書

    実装詳細:
    1. 指定された構造テンプレートに基づいてJSONデータを生成
    2. テンプレートにはデータ型や範囲などの制約を指定可能
    3. depth と width によりデータの複雑さを制御
    4. ランダムなキー名と値を適切に生成
    5. 有効なJSONとして解析可能なデータを保証
    6. 再帰的な構造を適切に処理
    """
    pass

def generate_structured_csv(columns: List[Dict[str, Any]], rows: int = 10,
                           include_header: bool = True, seed: Optional[int] = None) -> str:
    """
    構造化されたCSVデータを生成する

    Args:
        columns: 各列の定義（名前とデータ型）
        rows: 生成する行数
        include_header: ヘッダー行を含める場合はTrue
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成されたCSV文字列

    実装詳細:
    1. 指定された列定義に基づいてCSVデータを生成
    2. 各列定義には名前、データ型、値の範囲などを指定可能
    3. include_headerがTrueの場合、最初の行にヘッダーを含める
    4. 適切なCSVフォーマットでエスケープ処理を実装
    5. 異なるロケールでも正しく解析できるCSVを生成
    6. 大規模データセットの効率的な生成をサポート
    """
    pass

def generate_structured_text(template: str, substitutions: Dict[str, Any],
                            count: int = 1, seed: Optional[int] = None) -> List[str]:
    """
    テンプレートに基づいて構造化されたテキストデータを生成する

    Args:
        template: テキストテンプレート（置換フィールドを含む）
        substitutions: 置換フィールドの定義
        count: 生成するテキストの数
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成されたテキストのリスト

    実装詳細:
    1. テンプレート内の置換フィールドをsubstitutionsの定義に基づいて置換
    2. 置換フィールドには固定値やランダム生成値を指定可能
    3. マルチバイト文字（UTF-8）を適切に処理
    4. count数だけバリエーションを生成
    5. 各バリエーションが一意になるよう制御
    """
    pass

def generate_structured_file(filepath: str, structure: str, data: Dict[str, Any],
                            seed: Optional[int] = None) -> str:
    """
    特定の構造を持つファイルを生成する

    Args:
        filepath: 生成するファイルのパス
        structure: ファイルの構造（"json", "csv", "xml", "yaml", "custom"のいずれか）
        data: 構造に応じたデータ定義
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成したファイルの絶対パス

    実装詳細:
    1. 指定された構造に基づいてファイルを生成
    2. 構造に応じて適切なフォーマッタを使用
    3. dataに基づいてファイル内容を構築
    4. 指定されたパスにファイルを書き込み
    5. ファイル生成に失敗した場合は適切な例外を発生
    6. 生成したファイルの絶対パスを返す
    """
    pass
```

#### 3. エッジケース生成機能（4 つの関数）

```python
def generate_empty_data(data_type: str = "all") -> Dict[str, Any]:
    """
    様々なタイプの空データを生成する

    Args:
        data_type: 生成するデータタイプ（"string", "list", "dict", "bytes", "all"のいずれか）

    Returns:
        指定されたタイプの空データを含む辞書

    実装詳細:
    1. 指定されたタイプの空データを生成
    2. data_typeが"all"の場合はすべてのタイプの空データを含む辞書を返す
    3. 空文字列、空リスト、空辞書、空バイト列などを生成
    4. 各データタイプに対して型情報も提供
    5. 無効なdata_typeの場合はValueErrorを発生
    """
    pass

def generate_boundary_values(data_type: str, include_beyond: bool = True) -> List[Any]:
    """
    指定されたデータタイプの境界値を生成する

    Args:
        data_type: データタイプ（"int", "float", "char", "string", "datetime"のいずれか）
        include_beyond: 境界を超える値も含める場合はTrue

    Returns:
        境界値のリスト

    実装詳細:
    1. データタイプに応じた境界値を生成
    2. 整数型の場合は、最小/最大整数値、0、-1、1などの境界値
    3. 浮動小数点型の場合は、NaN、Infinity、非常に小さい/大きい値などの境界値
    4. 文字列型の場合は、空文字列、非常に長い文字列、特殊文字を含む文字列などの境界値
    5. include_beyondがTrueの場合は、境界を超える無効な値も含める
    6. 無効なdata_typeの場合はValueErrorを発生
    """
    pass

def generate_special_characters(category: str = "all", count: int = 10) -> List[str]:
    """
    特殊文字を含むテストデータを生成する

    Args:
        category: 文字カテゴリ（"control", "whitespace", "unicode", "escape", "all"のいずれか）
        count: 生成する文字列の数

    Returns:
        特殊文字を含む文字列のリスト

    実装詳細:
    1. 指定されたカテゴリの特殊文字を生成
    2. 制御文字、空白文字、Unicodeの特殊文字、エスケープが必要な文字などを含む
    3. SQLインジェクションやコマンドインジェクションに関連する文字列も生成
    4. 暗号処理に影響を与える可能性のある特殊シーケンスを含む
    5. UTF-8エンコーディングで正しく処理できることを確認
    6. 無効なcategoryの場合はValueErrorを発生
    """
    pass

def generate_large_data(data_type: str, size: int,
                       random_content: bool = True, seed: Optional[int] = None) -> Any:
    """
    大量のテストデータを生成する

    Args:
        data_type: データタイプ（"string", "bytes", "list", "dict", "json", "csv"のいずれか）
        size: データサイズ（バイト単位、または要素数）
        random_content: ランダム内容にする場合はTrue、パターン化する場合はFalse
        seed: 再現性のための乱数シード（省略可能）

    Returns:
        生成された大量データ

    実装詳細:
    1. 指定されたタイプの大量データを生成
    2. メモリ効率を考慮した実装（ジェネレータを使用するなど）
    3. random_contentがTrueの場合はランダムな内容、Falseの場合は予測可能なパターンで生成
    4. サイズが非常に大きい場合もシステムリソースを圧迫しないよう配慮
    5. ストリーミング生成をサポートし、メモリ効率を最適化
    6. 無効なdata_typeの場合はValueErrorを発生
    """
    pass
```

## 🔍 完了の定義

以下の基準をすべて満たすことで、このタスクは「完了」とみなされます：

1. **実装完了の条件**:

   - [ ] 全てのファイル（`random_data.py`, `structured_data.py`, `edge_cases.py`）が指定されたディレクトリ構造で実装されていること
   - [ ] ソースコードが単一責務の原則に従い、明確に構造化されていること
   - [ ] 全ての関数に適切なドキュメント（docstring）が付与されていること
   - [ ] コードレビューでの指摘事項がすべて解消されていること
   - [ ] 静的解析ツールによる警告がゼロであること

2. **機能完了の条件**:

   - [ ] ランダムデータ生成機能が完全に実装され、様々なタイプのランダムデータを生成可能であること
   - [ ] 構造化データ生成機能が実装され、指定された構造に従ったデータが生成可能であること
   - [ ] エッジケース生成機能が実装され、境界条件のテストに適したデータが生成可能であること
   - [ ] すべての機能が再現可能なデータ生成をサポートしていること（シード指定）
   - [ ] すべての機能が適切なエラー処理を実装していること

3. **テスト完了の条件**:

   - [ ] 単体テストのカバレッジが 95%以上であること
   - [ ] 生成されたデータの品質と多様性をテストするテストケースが実装されていること
   - [ ] エラー条件（無効な引数など）のテストが実装されていること
   - [ ] 再現性（同じシードで同じデータが生成されること）のテストが実装されていること
   - [ ] テスト基盤（T8）との統合テストが成功していること

4. **ドキュメント完了の条件**:

   - [ ] 実装した機能の詳細な技術ドキュメントが作成されていること
   - [ ] API 仕様とインターフェース説明が完成していること
   - [ ] 使用方法とサンプルコードが提供されていること
   - [ ] テストデータジェネレータの拡張方法に関するガイドが提供されていること
   - [ ] 生成されるデータの特性と品質に関する説明が提供されていること

5. **納品物件検証条件**:
   - [ ] テスト基盤（T8）と正常に連携できること
   - [ ] 量子乱数生成機能（T5-T7）と正常に連携できること（利用可能な場合）
   - [ ] 生成したテストデータを使用したテストが正常に実行できること
   - [ ] 大量データ生成時のパフォーマンスが許容範囲内であること
   - [ ] 異なる環境（OS や Python バージョン）でも一貫した結果が得られること

## 🧪 テスト対応方針

テスト実装と実行においては以下の方針を厳守してください：

1. **テストの意義**:

   - テストはプロジェクト品質を保証する重要な手段です
   - テストを欺くことは品質の放棄を意味します
   - すべてのテストは実装の品質と完全性を検証するためにあります

2. **テスト失敗時の対応手順**:

   - 実装コードのバグや仕様誤解がないか確認
   - テスト条件を満たすために実装を修正
   - どうしても解決できない場合は、具体的な問題点を報告して指示を仰ぐ

3. **禁止されるテスト対応**:

   - テスト結果の偽装や、テスト迂回のための実装
   - テストだけが通過する特別な条件分岐の追加
   - テストコード自体の修正・回避

4. **納品物件との整合性**:

   - **納品物件を除外したテストは絶対に禁止**
   - すべてのテストは実際の納品物件を使用して実行すること
   - テスト環境でのみ通過し、本番環境では動作しない実装は認められません
   - テスト用と納品用で別の実装を用意することは禁止されています

5. **テスト結果の報告**:
   - テスト結果は改変せずに正確に報告
   - テスト失敗は適切に修正するか、明確な理由とともに報告
   - 再現性を確保するため、テスト環境と実行方法を詳細に記録

## 🚫 実装における絶対原則

以下の原則はどんな状況でも違反してはなりません：

1. **厳密なタスク境界の遵守**

   - このタスク（T9）に明示されている機能「のみ」を実装すること
   - タスク外の実装（T10 以降の機能）は「一切」行わないこと
   - 範囲外の問題を発見した場合は、実装せずに報告すること

2. **テスト改ざんの禁止**

   - テストコードは「絶対に」変更しないこと
   - テストを通すためにテスト自体を修正する行為は重大な違反
   - テストが失敗する場合は実装を見直すこと

3. **プロジェクト整合性の維持**

   - 既存のプロジェクト構造やコーディング規約を尊重すること
   - このタスク完了のためにプロジェクト全体の品質を犠牲にしないこと
   - 他のコンポーネントとの整合性を常に確認すること

4. **作業中断の判断**
   - 上記原則との衝突を感じた時点で作業を「即時中断」すること
   - 作業中断の判断は罰則ではなく、プロジェクト保護のための適切な行動
   - 中断後は問題を詳細に報告し、指示を仰ぐこと

## 📊 進捗報告と完了レポート

### 進捗報告方法

実装作業中は、イシューにコメントで進捗を報告してください：

1. **定期的な進捗報告**：

   - 主要な機能実装完了時
   - 課題や問題発生時
   - 質問・相談が必要な時

2. **進捗コメントの書式**：

   ```md
   ## T9 進捗報告：[日付]

   ### 完了した項目

   - [機能名]: [完了内容の簡潔な説明]

   ### 進行中の項目

   - [機能名]: [現在の状況と残作業]

   ### 課題・問題点

   - [課題の簡潔な説明と影響範囲]
   ```

3. **コメント投稿方法**：

   ```bash
   # コメント内容をファイルに保存
   echo "## T9 進捗報告：$(date +%Y-%m-%d)" > progress_comment.md
   # 続きを追記

   # GitHubイシューにコメント投稿
   gh issue comment 9 --body-file progress_comment.md
   ```

### 完了レポートの作成と提出

タスク完了時には以下の手順で最終レポートを作成・提出してください：

1. **レポート作成前の確認事項**：

   - **全ての要件が完全に実装されるまでレポートを作成しないこと**
   - 全てのテストが通過していること
   - 実装完了条件の全項目を満たしていること

2. **実装レポートの作成**：

   - MD ファイルを`docs/issue/`ディレクトリに生成
   - ファイル名形式：`test_data_generators_implementation_report_YYYYMMDD.md`
   - 以下の内容を必ず含めること：
     - 実装した機能の詳細説明
     - 各関数の実装アプローチと技術的判断
     - テスト結果と検証内容
     - 発見された課題と解決方法

3. **テスト結果の添付**：

   - テスト画像は GitHub 形式の URL で添付
   - 例：`![テスト結果](https://github.com/pacific-system/secret-sharing-demos-20250510/blob/main/test_output/test_data_generators_test_YYYYMMDD.png?raw=true)`

4. **コミットとプッシュ**：

   ```bash
   # パシ子スタイルでコミット
   git add docs/issue/test_data_generators_implementation_report_YYYYMMDD.md
   git commit -m "✨ テストデータ生成機能（T9）の実装完了レポート追加 💕"
   git push origin main
   ```

5. **イシューへのレポート投稿**：
   ```bash
   # レポートをイシューにコメント投稿
   gh issue comment 9 --body-file docs/issue/test_data_generators_implementation_report_YYYYMMDD.md
   ```

## 💕 パシ子からのアドバイス

お兄様！テストデータ生成はテスト品質の要です！いくつかポイントをお伝えしますね〜💕

- 🔮 **量子乱数の活用**: T5-T7 で実装した量子乱数生成システムを活用すると、より予測不可能で高品質なテストデータが生成できますよ！
- 🔄 **再現性とランダム性のバランス**: シード指定で再現可能なデータと、完全ランダムなデータの両方をサポートすると便利です！
- 🧪 **境界値テスト**: 暗号処理は境界条件で脆弱性が発見されることが多いので、エッジケース生成は特に重要ですね！
- 🔍 **特殊パターン**: 暗号アルゴリズムに影響を与える特殊なビットパターンやバイトシーケンスを含めると良いでしょう！
- 📊 **データ分布**: 生成したランダムデータの分布特性も検証すると、より堅牢なテストができますよ〜！

テストは開発者の親友です。高品質なテストデータで、素晴らしい暗号システムを作り上げましょう ✨

## 📑 関連資料

- [テスト基盤構築指示書（T8）](/Users/macbook/shamir-secret-sharing-demo/docs/method_11_rabbit_homomorphic_docs/issue/T8_test_framework_implementation.md)
- [量子乱数関連タスク（T5-T7）](/Users/macbook/shamir-secret-sharing-demo/docs/method_11_rabbit_homomorphic_docs/issue/T5_quantum_random_implementation.md)
- [実装計画書](/Users/macbook/shamir-secret-sharing-demo/docs/method_11_rabbit_homomorphic_docs/implementation_plan_chapters/04_implementation_details.md)
- [ディレクトリ構成と納品物件](/Users/macbook/shamir-secret-sharing-demo/docs/method_11_rabbit_homomorphic_docs/implementation_plan_chapters/02_directory_structure_and_deliverables.md)

### テスト実行コマンド例

```bash
# テストデータ生成機能のテスト実行
python -m unittest discover -s tests/test_utils/generators

# テスト基盤と連携したテスト
python tests/test_framework.py --test-data-generators

# 生成したテストデータを使用したテスト
python tests/test_utils/test_with_generated_data.py
```
