# シャミア秘密分散法による複数平文復号システム設計書

## 0. 用語集

本設計書で使用される重要な用語と概念の定義を以下に示す：

### 0.1. 基本用語

| 用語                   | 定義                                                                                                                                                                        |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **シャミア秘密分散法** | Adi Shamir が考案した閾値暗号の一種。秘密情報を複数の「シェア」に分散し、一定数（閾値）以上のシェアが集まると元の情報を復元できるが、閾値未満では全く情報を得られない技術。 |
| **閾値（threshold）**  | 秘密情報を復元するために必要なシェアの最小数。例えば閾値 3 の場合、3 つ以上のシェアがあれば復元可能だが、2 つ以下では一切復元できない。                                     |
| **シェア（share）**    | シャミア秘密分散法によって生成される、秘密情報の断片。各シェアは（ID, 値）のペアで構成される。                                                                              |
| **チャンク（chunk）**  | 暗号化する前のデータを固定長の小さな断片に分割したもの。各チャンクに対してシャミア秘密分散法を適用する。                                                                    |
| **パーティション空間** | システム内で使用されるシェア ID の全体集合。A 用、B 用、未割当ての 3 種類に分割される。                                                                                     |
| **MAP（マップ）**      | 混在するシェア群の中から、必要なシェアを特定するための対応表または関数。特定の文書を復号する際に必要なシェアを選別するために使用される。                                    |

### 0.2. 本システム特有の用語

| 用語                         | 定義                                                                                                                                                                                                                        |
| ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **パーティションマップキー** | ユーザーが保持する文字列で、特定の範囲のシェア ID を特定するためのキー。例：「A 用パーティションマップキー」で「A 用シェア」の ID セットを特定できる。単なる ID の集合ではなく、ID を特定するための元データとして機能する。 |
| **多段 MAP 方式**            | 本システムの核心技術。パーティションマップキーによる第 1 段階 MAP とパスワードによる第 2 段階 MAP を組み合わせて、必要なシェアを特定する方式。                                                                              |
| **第 1 段階 MAP**            | パーティションマップキーから生成される MAP。全シェア空間から復号に必要な候補シェアの範囲を特定する。                                                                                                                        |
| **第 2 段階 MAP**            | パスワードから生成される MAP。第 1 段階で特定された候補シェアの中から、実際に復号に使用するシェアを選別する。                                                                                                               |
| **統計的区別不可能性**       | 暗号ファイル内の異なる文書（A/B）のシェアや未割当領域のシェアが統計的に区別できない性質。外部観察者がどのシェアがどの文書に属するか識別できないことを保証する。                                                             |
| **直線的処理**               | 復号処理の途中で条件分岐や評価を含まず、同一のコードパスを通り抜ける処理方式。タイミング攻撃やサイドチャネル攻撃への耐性を持つ。                                                                                            |

### 0.3. データ構造と実装関連用語

| 用語               | 定義                                                                                                                                                                                                                                                                  |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **メタデータ**     | 暗号化ファイルに保存される最小限の構成情報。具体的には以下の 3 つの情報のみを含む：<br>1. 閾値（threshold）：シェア復元に必要な最小シェア数<br>2. ソルト値（salt）：第 2 段階 MAP を生成するための乱数値<br>3. 総チャンク数（total_chunks）：元データの分割チャンク数 |
| **ガベージシェア** | 未割当領域に配置される無意味なデータ。有効なシェアと統計的に区別できない形式で生成され、セキュリティ強化と将来の拡張性確保に役立つ。                                                                                                                                  |
| **一時ファイル**   | 更新処理中に使用される中間ファイル。シャミア秘密分散法で暗号化され、処理完了時に削除される。                                                                                                                                                                          |
