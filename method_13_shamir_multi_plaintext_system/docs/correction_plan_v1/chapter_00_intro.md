# シャミア秘密分散法による複数平文復号システム修正プロンプト

## システム概要

シャミア秘密分散法を用いた複数平文復号システムは、単一の暗号化ファイルから異なるパスワードとパーティションキーを使用して、異なる平文（JSON 文書）を復号可能にする技術です。このシステムは「パーティションマップキーによる MAP 生成とパスワードによるマップ生成」という多段 MAP 方式を核心としています。

## 現在の実装における問題点と修正指示

以下に、現在のシステムで確認されている問題点と修正指示を示します。各問題は優先度順に配置され、それぞれコードレベルの修正指示が含まれています。

### 修正の目的とゴール

この修正の目的は、システムの信頼性と一貫性を向上させ、複数ユーザー間でのデータ分離を確実にし、処理効率を最適化することです。具体的には以下を達成します：

1. パーティションキー機能を正しく実装し、ユーザー間のデータ分離を確保
2. 同じキーとパスワードによる一貫した暗号化/復号を保証
3. 更新処理を改善し、複数ユーザーデータの共存を可能に
4. メモリ使用量を削減し、大規模データにも対応
5. 暗号化ファイル形式の効率化

### 全体的なアプローチ

修正は以下の原則に従って実施します：

- 互換性の確保: 既存の API とインターフェースを維持
- 漸進的改善: 一度にすべてを変更せず、段階的に改善
- テスト駆動開発: 各修正には対応するテストを追加
- ドキュメント化: すべての変更は明確に文書化

### 重要な実装の考慮事項

1. **決定論的アルゴリズム**: パーティションキーとパスワードから常に同じ結果を生成する
2. **メモリ効率**: 大きなデータセットでもメモリ使用量を抑制
3. **エラー処理**: 明確なエラーメッセージと回復メカニズム
4. **セキュリティ**: 情報漏洩を防ぐためのセキュリティ対策

それでは、各問題点の詳細な修正指示に進みます。
