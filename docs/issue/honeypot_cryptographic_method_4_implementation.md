# æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ ğŸ¯ æš—å·åŒ–å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ

## ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
- [å®Ÿè£…ãƒ•ãƒ­ãƒ¼](#å®Ÿè£…ãƒ•ãƒ­ãƒ¼)
- [ä¸»è¦æ©Ÿèƒ½ã¨å®Ÿè£…è©³ç´°](#ä¸»è¦æ©Ÿèƒ½ã¨å®Ÿè£…è©³ç´°)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–)
- [ãƒ†ã‚¹ãƒˆçµæœ](#ãƒ†ã‚¹ãƒˆçµæœ)
- [å®Ÿè£…ã®è¦ç‚¹](#å®Ÿè£…ã®è¦ç‚¹)
- [ã¾ã¨ã‚](#ã¾ã¨ã‚)

## æ¦‚è¦

æœ¬ãƒ¬ãƒãƒ¼ãƒˆã¯ã€æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ã®æš—å·åŒ–å®Ÿè£…ï¼ˆ`encrypt.py`ï¼‰ã«é–¢ã™ã‚‹è©³ç´°ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚ã“ã®å®Ÿè£…ã¯ã€åŒä¸€ã®æš—å·æ–‡ã‹ã‚‰éµã«å¿œã˜ã¦ç•°ãªã‚‹å¹³æ–‡ï¼ˆæ­£è¦ãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯éæ­£è¦ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’å¾©å…ƒã§ãã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚æ”»æ’ƒè€…ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’å…¥æ‰‹ã—ã¦ã‚‚ã€å¾©å·ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®çœŸå½ï¼ˆæ­£è¦ã‹éæ­£è¦ã‹ï¼‰ã‚’åˆ¤å®šã§ããªã„ã‚ˆã†ã€æ§˜ã€…ãªå¯¾ç­–ãŒæ–½ã•ã‚Œã¦ã„ã¾ã™ã€‚

### å®Ÿè£…ã®ä¸»ãªç‰¹å¾´

- ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸéµãƒšã‚¢ç”Ÿæˆ
- å¯¾ç§°æš—å·ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æš—å·åŒ–
- ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ–ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§
- èª¤èª˜å°ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹æ”»æ’ƒè€…ã®æ··ä¹±
- å‹•çš„åˆ¤å®šé–¾å€¤ã®å®Ÿè£…

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
method_7_honeypot/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ config.py            # è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
â”œâ”€â”€ encrypt.py           # æš—å·åŒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆæœ¬å®Ÿè£…ï¼‰
â”œâ”€â”€ decrypt.py           # å¾©å·ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”œâ”€â”€ trapdoor.py          # ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã®å®Ÿè£…
â”œâ”€â”€ honeypot_capsule.py  # ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ–ã®å®Ÿè£…
â”œâ”€â”€ key_verification.py  # éµæ¤œè¨¼ã®å®Ÿè£…
â”œâ”€â”€ honeypot_crypto.py   # æš—å·ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ honeypot_simple.py   # ç°¡æ˜“ç‰ˆãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆå®Ÿè£…
â”œâ”€â”€ deception.py         # æ”»æ’ƒè€…èª¤èª˜å°æ©Ÿèƒ½
â”œâ”€â”€ README.md            # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª¬æ˜
â””â”€â”€ tests/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_encrypt.py              # æš—å·åŒ–æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ test_encrypt_timing.py       # ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ test_encrypt_decrypt.py      # æš—å·åŒ–ãƒ»å¾©å·ã®çµåˆãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ test_honeypot_demo.py        # ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â”œâ”€â”€ test_key_verification.py     # éµæ¤œè¨¼ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ test_tamper_resistance.py    # æ”¹ã–ã‚“è€æ€§ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ test_trapdoor.py             # ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ãƒ†ã‚¹ãƒˆ
```

## å®Ÿè£…ãƒ•ãƒ­ãƒ¼

æš—å·åŒ–å‡¦ç†ã®æµã‚Œã‚’ä»¥ä¸‹ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§ç¤ºã—ã¾ã™ï¼š

```mermaid
flowchart TB
    A[å…¥åŠ›: true.text & false.text] --> B[ãƒã‚¹ã‚¿ãƒ¼éµç”Ÿæˆ]
    B --> C[ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆ]
    C --> D[éµãƒšã‚¢å°å‡º]
    D --> E1[æ­£è¦ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–]
    D --> E2[éæ­£è¦ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–]
    E1 --> F[ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«ä½œæˆ]
    E2 --> F
    F --> G[ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜åŠ ]
    G --> H[å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ]
    H --> I[éµæƒ…å ±ä¿å­˜\n(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)]
```

## ä¸»è¦æ©Ÿèƒ½ã¨å®Ÿè£…è©³ç´°

### 1. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°å‡¦ç†

`parse_arguments()` é–¢æ•°ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆï¼š

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³        | èª¬æ˜                           |
| ----------------- | ------------------------------ |
| `--true-file`     | æ­£è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹æŒ‡å®š         |
| `--false-file`    | éæ­£è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹æŒ‡å®š       |
| `--output`, `-o`  | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹æŒ‡å®š         |
| `--output-dir`    | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š         |
| `--prefix`        | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ |
| `--save-keys`     | éµã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ãƒ•ãƒ©ã‚°   |
| `--keys-dir`      | éµä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š       |
| `--verbose`, `-v` | è©³ç´°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰                 |
| `--dump-metadata` | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰           |

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°è§£æã§ã¯ã€ã‚ã‹ã‚Šã‚„ã™ã„ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ä½¿ç”¨ä¾‹ã‚’è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã¦ã„ã¾ã™ã€‚

### 2. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ©Ÿèƒ½

`read_file()` é–¢æ•°ã¯ã€ãƒã‚¤ãƒŠãƒªãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ï¼š

```python
def read_file(file_path: str) -> bytes:
    try:
        with open(file_path, 'rb') as f:
            return f.read()
    except FileNotFoundError:
        print(f"ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ« '{file_path}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", file=sys.stderr)
        raise
    except PermissionError:
        print(f"ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ« '{file_path}' ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", file=sys.stderr)
        raise
    except OSError as e:
        print(f"ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ« '{file_path}' ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}", file=sys.stderr)
        raise
```

### 3. å¯¾ç§°æš—å·åŒ–æ©Ÿèƒ½

`symmetric_encrypt()` é–¢æ•°ã§ã¯ã€AES-CTR ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ï¼š

```python
def symmetric_encrypt(data: bytes, key: bytes) -> Tuple[bytes, bytes]:
    try:
        # cryptographyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
        from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
        from cryptography.hazmat.backends import default_backend

        # åˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç”Ÿæˆ
        iv = os.urandom(16)

        # AES-CTRãƒ¢ãƒ¼ãƒ‰ã§æš—å·åŒ–
        cipher = Cipher(
            algorithms.AES(key),
            modes.CTR(iv),
            backend=default_backend()
        )
        encryptor = cipher.encryptor()
        ciphertext = encryptor.update(data) + encryptor.finalize()

        # èªè¨¼ã‚¿ã‚°ã‚’è¨ˆç®—
        auth_tag = hashlib.sha256(key + iv + ciphertext).digest()[:16]

        # æš—å·æ–‡ã¨èªè¨¼ã‚¿ã‚°ã‚’çµåˆ
        return ciphertext + auth_tag, iv
    except Exception as e:
        raise RuntimeError(f"æš—å·åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
```

### 4. ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ–

`encrypt_files()` é–¢æ•°ã§ã¯ã€ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸéµç”Ÿæˆã¨ã€ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’å®Ÿè£…ï¼š

```python
def encrypt_files(true_file_path: str, false_file_path: str, output_path: str,
                 verbose: bool = False) -> Tuple[Dict[str, bytes], Dict[str, Any]]:
    # ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    true_data = read_file(true_file_path)
    false_data = read_file(false_file_path)

    # ãƒã‚¹ã‚¿ãƒ¼éµã®ç”Ÿæˆ
    master_key = create_master_key()

    # ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç”Ÿæˆ
    trapdoor_params = create_trapdoor_parameters(master_key)

    # éµãƒšã‚¢ã®å°å‡º
    keys, salt = derive_keys_from_trapdoor(trapdoor_params)

    # ãƒ‡ãƒ¼ã‚¿ã®å¯¾ç§°æš—å·åŒ–
    true_encrypted, true_iv = symmetric_encrypt(true_data, keys[KEY_TYPE_TRUE])
    false_encrypted, false_iv = symmetric_encrypt(false_data, keys[KEY_TYPE_FALSE])

    # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
    metadata = {
        "format": OUTPUT_FORMAT,
        "version": "1.0",
        "algorithm": "honeypot",
        "salt": base64.b64encode(salt).decode('ascii'),
        "true_iv": base64.b64encode(true_iv).decode('ascii'),
        "false_iv": base64.b64encode(false_iv).decode('ascii'),
        "creation_timestamp": timestamp,
        "true_file": os.path.basename(true_file_path),
        "false_file": os.path.basename(false_file_path),
        "content_hash": hashlib.sha256(true_data + false_data).hexdigest()[:16]
    }

    # ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«ã®ä½œæˆ
    capsule_data = create_honeypot_file(
        true_encrypted, false_encrypted, trapdoor_params, metadata
    )

    # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
    with open(output_path, 'wb') as f:
        f.write(capsule_data)

    # éµæƒ…å ±ã‚’è¿”å´
    key_info = {
        KEY_TYPE_TRUE: keys[KEY_TYPE_TRUE],
        KEY_TYPE_FALSE: keys[KEY_TYPE_FALSE],
        "master_key": master_key
    }

    return key_info, metadata
```

### 5. éµä¿å­˜æ©Ÿèƒ½

`save_keys()` é–¢æ•°ã«ã‚ˆã‚Šã€ç”Ÿæˆã•ã‚ŒãŸéµã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ï¼š

```python
def save_keys(key_info: Dict[str, bytes], output_dir: str, base_name: str) -> Dict[str, str]:
    # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰
    try:
        os.makedirs(output_dir, exist_ok=True)
    except OSError as e:
        raise OSError(f"éµä¿å­˜ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")

    key_files = {}

    # å„éµã‚¿ã‚¤ãƒ—ã«ã¤ã„ã¦
    for key_type, key in key_info.items():
        # éµãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ§‹ç¯‰
        filename = f"{base_name}.{key_type}.key"
        file_path = os.path.join(output_dir, filename)

        # éµã‚’ä¿å­˜
        try:
            with open(file_path, 'wb') as f:
                f.write(key)
        except OSError as e:
            raise OSError(f"éµãƒ•ã‚¡ã‚¤ãƒ« '{file_path}' ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")

        key_files[key_type] = file_path

    return key_files
```

### 6. ãƒ¡ã‚¤ãƒ³é–¢æ•°

`main()` é–¢æ•°ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®å‡¦ç†ã€æš—å·åŒ–å®Ÿè¡Œã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ï¼š

```python
def main():
    # å¼•æ•°ã‚’è§£æ
    args = parse_arguments()

    # å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèª
    for file_path in [args.true_file, args.false_file]:
        if not os.path.exists(file_path):
            print(f"ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ« '{file_path}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", file=sys.stderr)
            return 1

    # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç”Ÿæˆ
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

    # å‡ºåŠ›ãƒ‘ã‚¹å‡¦ç†
    # ...ï¼ˆçœç•¥ï¼‰...

    try:
        # æš—å·åŒ–ã®å®Ÿè¡Œ
        key_info, metadata = encrypt_files(
            args.true_file, args.false_file, args.output, args.verbose
        )

        # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ãƒ³ãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        if args.dump_metadata:
            print("\nãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿:")
            for key, value in metadata.items():
                print(f"  {key}: {value}")

        # éµã®ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        if args.save_keys:
            base_name = Path(args.output).stem
            save_keys(key_info, args.keys_dir, base_name)
        else:
            # éµã‚’è¡¨ç¤º
            for key_type, key in key_info.items():
                if key_type != "master_key":  # ãƒã‚¹ã‚¿ãƒ¼éµã¯è¡¨ç¤ºã—ãªã„
                    print(f"{key_type}éµ: {binascii.hexlify(key).decode()}")

        print(f"æš—å·åŒ–ãŒæˆåŠŸã—ã¾ã—ãŸ: {args.output}")
        return 0

    except Exception as e:
        # ä¾‹å¤–å‡¦ç†
        # ...ï¼ˆçœç•¥ï¼‰...
        return 1
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### 1. ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–

å‡¦ç†æ™‚é–“ã«ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã‚’é˜²æ­¢ã—ã¾ã™ï¼š

```python
# å‡¦ç†æ™‚é–“ã«ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’åŠ ãˆã‚‹ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–ï¼‰
time.sleep(random.uniform(0.01, 0.05))
```

### 2. èª¤èª˜å°ã‚³ãƒ¡ãƒ³ãƒˆ

æ”»æ’ƒè€…ã‚’æ··ä¹±ã•ã›ã‚‹ãŸã‚ã®èª¤èª˜å°ã‚³ãƒ¡ãƒ³ãƒˆã‚’å®Ÿè£…ï¼š

```python
# æ³¨: ã“ã®ã‚³ãƒ¼ãƒ‰ã¯å®Ÿéš›ã®åˆ¤å®šã«ã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ãŒã€
# æ”»æ’ƒè€…ã«ã“ã®éƒ¨åˆ†ãŒé‡è¦ã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«éŒ¯è¦šã•ã›ã¾ã™
dynamic_threshold = DECISION_THRESHOLD
if RANDOMIZATION_FACTOR > 0:
    dynamic_threshold += (random.random() * RANDOMIZATION_FACTOR - RANDOMIZATION_FACTOR/2)

# ã“ã®ãƒ€ãƒŸãƒ¼ã‚³ãƒ¼ãƒ‰ã¯å®Ÿéš›ã®æš—å·åŒ–ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“
dummy_value = random.random()
if dummy_value < dynamic_threshold:
    # æ”»æ’ƒè€…ã‚’æ··ä¹±ã•ã›ã‚‹ãŸã‚ã®ãƒ€ãƒŸãƒ¼ã‚³ãƒ¼ãƒ‰
    _dummy_token = os.urandom(16)
```

### 3. å‹•çš„åˆ¤å®šé–¾å€¤

`config.py` ã§ã®é–¾å€¤è¨­å®šã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ãŒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã§ããªã„ã‚ˆã†ã«ã—ã¾ã™ï¼š

```python
# å‹•çš„åˆ¤å®šé–¾å€¤è¨­å®š
DECISION_THRESHOLD = 0.65  # åˆ¤å®šåŸºæº–å€¤ï¼ˆ0.5ã€œ1.0ã®ç¯„å›²ï¼‰
RANDOMIZATION_FACTOR = 0.1  # ãƒ©ãƒ³ãƒ€ãƒ åŒ–ä¿‚æ•°ï¼ˆåˆ¤å®šã«ãƒã‚¤ã‚ºã‚’è¿½åŠ ï¼‰
TIME_VARIANCE_MS = 15  # å‡¦ç†æ™‚é–“ã®ã°ã‚‰ã¤ãï¼ˆãƒŸãƒªç§’ï¼‰
```

### 4. åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

ã™ã¹ã¦ã®æ“ä½œã«å¯¾ã—ã¦é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡ŒãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆçµæœ

### 1. åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

`test_encrypt.py` ã«ã‚ˆã‚‹å„æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆçµæœï¼š

| ãƒ†ã‚¹ãƒˆé …ç›®       | çµæœ    | å‚™è€ƒ                           |
| ---------------- | ------- | ------------------------------ |
| ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ | âœ… æˆåŠŸ | ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å‡¦ç†ã‚‚ç¢ºèª |
| å¯¾ç§°æš—å·åŒ–       | âœ… æˆåŠŸ | IV ã®ä¸€æ„æ€§ã¨æš—å·æ–‡ã®æ¤œè¨¼      |
| ãƒ•ã‚¡ã‚¤ãƒ«æš—å·åŒ–   | âœ… æˆåŠŸ | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨éµæƒ…å ±ã®æ¤œè¨¼       |
| éµä¿å­˜æ©Ÿèƒ½       | âœ… æˆåŠŸ | ä¿å­˜ã•ã‚ŒãŸéµã®æ•´åˆæ€§ã‚’ç¢ºèª     |
| ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ | âœ… æˆåŠŸ | æš—å·åŒ–ã‹ã‚‰å¾©å·ã¾ã§ã®æµã‚Œã‚’ç¢ºèª |

### 2. ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆ

`test_encrypt_timing.py` ã«ã‚ˆã‚‹æš—å·åŒ–å‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æçµæœï¼š

```
æš—å·åŒ–å‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æçµæœ:
æ­£è¦éµå¹³å‡æ™‚é–“: 0.000104ç§’
éæ­£è¦éµå¹³å‡æ™‚é–“: 0.000162ç§’
æ™‚é–“å·®: 0.000058ç§’ (56.32%)

âœ… ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ã‚ã‚Š: æš—å·åŒ–æ™‚é–“ã®å·®ãŒé–¾å€¤(0.001ç§’)æœªæº€ã§ã™
```

![ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆ](https://github.com/pacific-system/secret-sharing-demos-20250510/blob/main/test_output/encrypt_timing_ascii_20250513_164444.txt?raw=true)

ã“ã®çµæœã‹ã‚‰ã€æ­£è¦éµã¨éæ­£è¦éµã®å‡¦ç†æ™‚é–“å·®ã¯ç´„ 58 ãƒã‚¤ã‚¯ãƒ­ç§’ã§ã€é–¾å€¤ï¼ˆ1 ãƒŸãƒªç§’ï¼‰ã‚’å¤§å¹…ã«ä¸‹å›ã£ã¦ãŠã‚Šã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã«å¯¾ã™ã‚‹ååˆ†ãªè€æ€§ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚

## å®Ÿè£…ã®è¦ç‚¹

### 1. ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ–

`honeypot_capsule.py` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ã€æ­£è¦ãƒ‡ãƒ¼ã‚¿ã¨éæ­£è¦ãƒ‡ãƒ¼ã‚¿ã‚’ 1 ã¤ã®ã‚«ãƒ—ã‚»ãƒ«ã«æ ¼ç´ã—ã€å¾©å·æ™‚ã«ä½¿ç”¨ã™ã‚‹éµã«ã‚ˆã£ã¦å–ã‚Šå‡ºã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ä»•çµ„ã¿ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

### 2. ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°

`trapdoor.py` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ã€ãƒã‚¹ã‚¿ãƒ¼éµã‹ã‚‰æ­£è¦éµã¨éæ­£è¦éµã‚’æ•°å­¦çš„ã«å°å‡ºã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ã‚ˆã‚Šã€ï¼’ã¤ã®éµã®é–¢é€£æ€§ãŒæ•°å­¦çš„ã«è¨¼æ˜ã§ããªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### 3. ç§˜å¯†çµŒè·¯ã®è­˜åˆ¥ä¸å¯èƒ½æ€§

åŒä¸€ã®æš—å·æ–‡ã‹ã‚‰ç•°ãªã‚‹å¹³æ–‡ã‚’å–ã‚Šå‡ºã›ã‚‹ä»•çµ„ã¿ã¯ã€æ•°å­¦çš„ã«ç§˜å¯†çµŒè·¯ã®è­˜åˆ¥ãŒä¸å¯èƒ½ãªè¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚æ”»æ’ƒè€…ãŒã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’è§£æã—ã¦ã‚‚ã€ã©ã¡ã‚‰ã®éµãŒã€Œæ­£è¦ã€ã‹ã€Œéæ­£è¦ã€ã‹ã‚’åˆ¤åˆ¥ã§ãã¾ã›ã‚“ã€‚

## ã¾ã¨ã‚

æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ã®æš—å·åŒ–å®Ÿè£…ï¼ˆ`encrypt.py`ï¼‰ã¯ã€è¦ä»¶ã‚’å…¨ã¦æº€ãŸã™å½¢ã§å®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚åŸºæœ¬çš„ãªæš—å·åŒ–æ©Ÿèƒ½ã ã‘ã§ãªãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–ã‚„èª¤èª˜å°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’å«ã‚€åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ãŒæ–½ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆçµæœã‹ã‚‰ã€æš—å·åŒ–å‡¦ç†ã®æ­£ç¢ºæ€§ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ãŒç¢ºèªã•ã‚Œã¦ãŠã‚Šã€å®Ÿç”¨ã«è€ãˆã‚‹å®Ÿè£…ã¨ãªã£ã¦ã„ã¾ã™ã€‚ç‰¹ã«ã€ç§˜å¯†çµŒè·¯ã®è­˜åˆ¥ã‚’æ•°å­¦çš„ã«ä¸å¯èƒ½ã«ã™ã‚‹è¨­è¨ˆã¯ã€æ”»æ’ƒè€…ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’å…¥æ‰‹ã—ãŸå ´åˆã§ã‚‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®çœŸå½ã‚’åˆ¤å®šã§ããªã„å¼·é­ãªã‚·ã‚¹ãƒ†ãƒ ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ã€Œãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæˆ¦ç•¥ã€ï¼ˆæ„å›³çš„ã«ã€Œæ­£è¦ã€éµã‚’æ¼æ´©ã•ã›ã¦å½æƒ…å ±ã‚’ä¿¡ã˜è¾¼ã¾ã›ã‚‹ï¼‰ã‚„ã€Œãƒªãƒãƒ¼ã‚¹ãƒˆãƒ©ãƒƒãƒ—ã€ï¼ˆæœ¬å½“ã«é‡è¦ãªæƒ…å ±ã‚’ã€Œéæ­£è¦ã€å´ã«éš ã™ï¼‰ã¨ã„ã£ãŸé«˜åº¦ãªæƒ…å ±ä¿è­·æˆ¦ç•¥ãŒå¯èƒ½ã¨ãªã‚Šã¾ã—ãŸã€‚
