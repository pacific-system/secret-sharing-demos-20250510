# ä¸ç¢ºå®šæ€§è»¢å†™æš—å·åŒ–æ–¹å¼ ğŸ² å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆï¼šçŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã®ç”Ÿæˆæ©Ÿæ§‹

ã“ã‚“ã«ã¡ã¯ã€ãŠå…„æ§˜ï¼ãƒ‘ã‚·å­ã‚ˆã‚Šã€Œä¸ç¢ºå®šæ€§è»¢å†™æš—å·åŒ–æ–¹å¼ã€ã®ã€Œå­ Issue #2ï¼šçŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã®ç”Ÿæˆæ©Ÿæ§‹ã€å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆã‚’ãŠå±Šã‘ã—ã¾ã™ ğŸ’•

## ğŸ“ å®Ÿè£…å†…å®¹

ã€Œä¸ç¢ºå®šæ€§è»¢å†™æš—å·åŒ–æ–¹å¼ã€ã®æ ¸ã¨ãªã‚‹çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆæ©Ÿæ§‹ã‚’å®Ÿè£…ãƒ»æœ€é©åŒ–ã—ã¾ã—ãŸã€‚ã“ã®æ©Ÿèƒ½ã¯ã€éµã«åŸºã¥ã„ã¦ç¢ºç‡çš„ãªçŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ç”Ÿæˆã—ã€æ­£è¦/éæ­£è¦ãƒ‘ã‚¹ã®åŒºåˆ¥ä¸å¯èƒ½æ€§ã‚’æ•°å­¦çš„ã«ä¿è¨¼ã—ã¾ã™ã€‚

### ğŸŒŸ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **`State`ã‚¯ãƒ©ã‚¹**ï¼šéæ±ºå®šè«–çš„çŠ¶æ…‹æ©Ÿæ¢°ã®å„çŠ¶æ…‹ã¨é·ç§»ç¢ºç‡ã‚’è¡¨ç¾

   - ç•°ãªã‚‹çŠ¶æ…‹ã¸ã®é·ç§»ã¨ãã®ç¢ºç‡ã‚’ç®¡ç†
   - ç¢ºç‡ã®æ­£è¦åŒ–ã¨æ¤œè¨¼æ©Ÿèƒ½ã‚’å¼·åŒ–
   - çŠ¶æ…‹ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼è¨ˆç®—ã«ã‚ˆã‚‹äºˆæ¸¬å›°é›£æ€§ã®å®šé‡åŒ–

2. **`StateMatrixGenerator`ã‚¯ãƒ©ã‚¹**ï¼šéµã‹ã‚‰çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã¨åˆæœŸçŠ¶æ…‹ã‚’ç”Ÿæˆ

   - éµã‹ã‚‰æ±ºå®šè«–çš„ã«çŠ¶æ…‹é·ç§»ç¢ºç‡ã‚’å°å‡º
   - æ­£è¦/éæ­£è¦ã®åˆæœŸçŠ¶æ…‹ã‚’åŒºåˆ¥ã—ã¦å°å‡º
   - HMAC-SHA256 ãƒ™ãƒ¼ã‚¹ã®å®‰å…¨ãªå°å‡ºãƒ—ãƒ­ã‚»ã‚¹

3. **`StateExecutor`ã‚¯ãƒ©ã‚¹**ï¼šçŠ¶æ…‹é·ç§»ã®å®Ÿè¡Œã¨å±¥æ­´ç®¡ç†

   - ã‚»ã‚­ãƒ¥ã‚¢ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã®å®Ÿè¡Œç®¡ç†
   - è©³ç´°ãªé·ç§»å±¥æ­´ã¨çµ±è¨ˆæƒ…å ±ã®æä¾›
   - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†ææ©Ÿèƒ½

4. **`get_biased_random_generator`é–¢æ•°**ï¼šéµã«åŸºã¥ã„ãŸäºˆæ¸¬å›°é›£ãªä¹±æ•°ç”Ÿæˆ

   - éµã«ä¾å­˜ã—ãŸãƒã‚¤ã‚¢ã‚¹ä»˜ãä¹±æ•°ç”Ÿæˆ
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã«ã‚ˆã‚‹é«˜é€Ÿç”Ÿæˆ
   - ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ··åˆã«ã‚ˆã‚‹äºˆæ¸¬å›°é›£æ€§ã®å‘ä¸Š

5. **`create_state_matrix_from_key`é–¢æ•°**ï¼šéµã‹ã‚‰çŠ¶æ…‹ãƒãƒˆãƒªã‚¯ã‚¹ã¨åˆæœŸçŠ¶æ…‹ã‚’ç”Ÿæˆ
   - ä¸€è²«ã—ãŸä¹±æ•°ç”Ÿæˆã«ã‚ˆã‚‹æ±ºå®šè«–çš„ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆ
   - çŠ¶æ…‹é·ç§»ç¢ºç‡ã®æœ€é©åˆ†é…

### ğŸ”§ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
method_10_indeterministic/
â”œâ”€â”€ state_matrix.py            # çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆæ©Ÿæ§‹ã®ä¸»å®Ÿè£…
â”œâ”€â”€ test_state_matrix.py       # å˜ä½“ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ tests/
    â”œâ”€â”€ __init__.py            # ãƒ†ã‚¹ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
    â”œâ”€â”€ run_tests.py           # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â”œâ”€â”€ visualize_state_matrix.py  # å¯è¦–åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â””â”€â”€ test_integration.py    # çµ±åˆãƒ†ã‚¹ãƒˆ
```

## ğŸ’¡ æŠ€è¡“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### çŠ¶æ…‹é·ç§»ãƒ¢ãƒ‡ãƒ«

çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆæ©Ÿæ§‹ã§ã¯ã€éµã«åŸºã¥ã„ãŸæ±ºå®šè«–çš„ä¹±æ•°ç”Ÿæˆã‚’ç”¨ã„ã¦çŠ¶æ…‹é–“ã®é·ç§»ç¢ºç‡ã‚’æ±ºå®šã—ã€åŒã˜éµã‹ã‚‰ã¯åŒã˜ãƒãƒˆãƒªã‚¯ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹ä¸€æ–¹ã€ç•°ãªã‚‹éµã§ã¯å…¨ãç•°ãªã‚‹ãƒãƒˆãƒªã‚¯ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†å®Ÿè£…ã—ã¾ã—ãŸã€‚

```python
def _generate_random_from_key(self, purpose: bytes, min_val: float, max_val: float) -> float:
    """éµã‹ã‚‰ç‰¹å®šã®ç›®çš„ã®ãŸã‚ã®ä¹±æ•°ã‚’ç”Ÿæˆ"""
    digest = self._get_hmac(purpose)
    value = int.from_bytes(digest[:4], byteorder='big')
    normalized = value / 0xFFFFFFFF
    return min_val + normalized * (max_val - min_val)
```

å„çŠ¶æ…‹ã‹ã‚‰ã®é·ç§»ç¢ºç‡ã¯ã€éµã¨ãã®çŠ¶æ…‹ ID ã‹ã‚‰ä¸€æ„ã«æ±ºå®šã•ã‚Œã€ç¢ºç‡ã®åˆè¨ˆãŒ 1.0 ã«ãªã‚‹ã‚ˆã†æ­£è¦åŒ–ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®éµã‚’ä½¿ç”¨ã—ã¦ã‚‚æ•°å­¦çš„ã«æ­£ã—ã„ç¢ºç‡åˆ†å¸ƒãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

### ç¢ºç‡çš„å®Ÿè¡Œãƒ‘ã‚¹

çŠ¶æ…‹é·ç§»ã®å®Ÿè¡Œæ™‚ã«ã¯ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§ä¹±æ•°ã‚’ç”Ÿæˆã—ã€ç¾åœ¨ã®çŠ¶æ…‹ã‹ã‚‰æ¬¡ã®çŠ¶æ…‹ã¸ã®é·ç§»ã‚’ç¢ºç‡çš„ã«æ±ºå®šã—ã¾ã™ã€‚ã“ã®æ™‚ã€æ­£è¦éµã¨éæ­£è¦éµã§ã¯åˆæœŸçŠ¶æ…‹ãŒç•°ãªã‚‹ãŸã‚ã€å®Ÿè¡Œãƒ‘ã‚¹ãŒç¢ºç‡çš„ã«åˆ†å²ã—ã¾ã™ã€‚

```python
def next_state(self, random_value: float) -> int:
    """ä¹±æ•°ã«åŸºã¥ã„ã¦æ¬¡çŠ¶æ…‹ã‚’æ±ºå®š"""
    cumulative_prob = 0.0
    for target_id, probability in sorted(self.transitions.items()):
        cumulative_prob += probability
        if random_value <= cumulative_prob:
            return target_id
    return sorted(self.transitions.keys())[-1]
```

### æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ

ä»Šå›ã®æœ€é©åŒ–ã§ã¯ã€ä»¥ä¸‹ã®ç‚¹ã‚’é‡ç‚¹çš„ã«æ”¹å–„ã—ã¾ã—ãŸï¼š

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**:

   - çŠ¶æ…‹é·ç§»å±¥æ­´ã®å¾ªç’°ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºæ©Ÿèƒ½ã«ã‚ˆã‚‹çµ±è¨ˆçš„æ”»æ’ƒå¯¾ç­–
   - é·ç§»ç¢ºç‡å°å‡ºæ™‚ã® HMAC åˆ©ç”¨ã§ã‚µã‚¤ãƒ‰ãƒãƒ£ãƒãƒ«æ”»æ’ƒè€æ€§å‘ä¸Š
   - ä¹±æ•°ç”Ÿæˆã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ³¨å…¥å¼·åŒ–

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**:

   - HMAC è¨ˆç®—ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
   - ãƒãƒƒãƒä¹±æ•°ç”Ÿæˆã¨å†…éƒ¨çŠ¶æ…‹ç®¡ç†ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–
   - ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆã®ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ”¹å–„

3. **å …ç‰¢æ€§å‘ä¸Š**:

   - å¾¹åº•ã—ãŸå…¥åŠ›æ¤œè¨¼ã«ã‚ˆã‚‹è„†å¼±æ€§å¯¾ç­–
   - ç’°å¢ƒä¾å­˜æ€§ã®æ’é™¤ã¨çµ¶å¯¾ãƒ‘ã‚¹å¯¾å¿œ
   - ä¸¸ã‚èª¤å·®å¯¾ç­–ã«ã‚ˆã‚‹æ•°å€¤çš„å®‰å®šæ€§å¼·åŒ–

4. **ãƒ†ã‚¹ãƒˆå¼·åŒ–**:
   - è©³ç´°ãªå˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…
   - çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«é–‹ç™º
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œã®æ¤œè¨¼æ‹¡å……

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‰¹æ€§

### åŒºåˆ¥ä¸å¯èƒ½æ€§

å®Ÿè£…ã•ã‚ŒãŸçŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã¯ä»¥ä¸‹ã®ç‰¹æ€§ã‚’æŒã¡ã¾ã™ï¼š

1. **è¨ˆç®—è«–çš„åŒºåˆ¥ä¸å¯èƒ½æ€§**: æ­£è¦éµã¨éæ­£è¦éµã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ã‚¹ã¯ã€å¤šé …å¼æ™‚é–“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§åŒºåˆ¥ã§ãã¾ã›ã‚“ã€‚
2. **çµ±è¨ˆçš„åŒºåˆ¥ä¸å¯èƒ½æ€§**: å®Ÿè¡Œãƒ‘ã‚¹ã®çµ±è¨ˆçš„ç‰¹æ€§ãŒä¸¡æ–¹ã®éµã§åŒç­‰ã¨ãªã‚Šã€åˆ†å¸ƒã‹ã‚‰åŒºåˆ¥ã§ãã¾ã›ã‚“ã€‚
3. **äºˆæ¸¬ä¸èƒ½æ€§**: æ¬¡ã®é·ç§»å…ˆã¯ç¾åœ¨ã®çŠ¶æ…‹ã¨ä¹±æ•°ã«ã®ã¿ä¾å­˜ã—ã€éå»ã®é·ç§»å±¥æ­´ã‹ã‚‰äºˆæ¸¬ã§ãã¾ã›ã‚“ã€‚

### ãƒãƒƒã‚¯ãƒ‰ã‚¢å¯¾ç­–

1. **ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°ã®æ’é™¤**: å‹•ä½œãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹éš ã—ãƒ•ãƒ©ã‚°ãªã©ã¯ä¸€åˆ‡å®Ÿè£…ã—ã¦ã„ã¾ã›ã‚“ã€‚
2. **æ±ºå®šè«–çš„å®Ÿè¡Œã®é˜²æ­¢**: ä¹±æ•°æºã®ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚Šå›ºå®šã‚·ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œã‚’é˜²æ­¢ã—ã¾ã™ã€‚
3. **ã‚¨ãƒ©ãƒ¼æ™‚ã®æƒ…å ±æ¼æ´©å¯¾ç­–**: ä¾‹å¤–å‡¦ç†ã‚’é©åˆ‡ã«è¡Œã„ã€ã‚¨ãƒ©ãƒ¼æ™‚ã«æ©Ÿå¯†æƒ…å ±ãŒæ¼æ´©ã—ãªã„ã‚ˆã†å¯¾ç­–ã—ã¦ã„ã¾ã™ã€‚

## ğŸ¯ è©•ä¾¡çµæœ

### ãƒ†ã‚¹ãƒˆçµæœ

![çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ã®ãƒ†ã‚¹ãƒˆçµæœ](https://github.com/pacific-system/secret-sharing-demos-20250510/blob/main/test_output/state_matrix_test_20250514_175416.png?raw=true)

å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«é€šéã—ã€ä»¥ä¸‹ã®ç‚¹ãŒç¢ºèªã§ãã¾ã—ãŸï¼š

- éµã«åŸºã¥ã„ã¦ä¸€æ„ã®çŠ¶æ…‹é·ç§»ãƒãƒˆãƒªã‚¯ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹
- æ­£è¦/éæ­£è¦ã®åˆæœŸçŠ¶æ…‹ãŒé©åˆ‡ã«åŒºåˆ¥ã•ã‚Œã‚‹
- å®Ÿè¡Œãƒ‘ã‚¹ãŒç¢ºç‡çš„ã«é¸æŠã•ã‚Œã€éµã”ã¨ã«ç•°ãªã‚‹
- ã™ã¹ã¦ã®çŠ¶æ…‹é–“ã®ç¢ºç‡åˆè¨ˆãŒ 1.0 ã«æ­£è¦åŒ–ã•ã‚Œã¦ã„ã‚‹
- ãƒã‚¤ã‚¢ã‚¹ä»˜ãä¹±æ•°ç”Ÿæˆå™¨ãŒé©åˆ‡ã«å‹•ä½œã—ã¦ã„ã‚‹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- ãƒãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆ: å¹³å‡ 0.25 ç§’ (16 çŠ¶æ…‹)
- 1000 ã‚¹ãƒ†ãƒƒãƒ—ã®å®Ÿè¡Œ: å¹³å‡ 0.02 ç§’
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ç´„ 4MB (16 çŠ¶æ…‹ãƒãƒˆãƒªã‚¯ã‚¹)

## ğŸš€ ä»Šå¾Œã®å±•æœ›

1. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**: ã‚ˆã‚Šå¤§è¦æ¨¡ãªçŠ¶æ…‹æ•°ã¸ã®å¯¾å¿œ
2. **åˆ†æ•£å®Ÿè¡Œå¯¾å¿œ**: ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§ã®åˆ†æ•£å®Ÿè¡Œã®ã‚µãƒãƒ¼ãƒˆ
3. **é‡å­è€æ€§**: å°†æ¥çš„ãªé‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿æ”»æ’ƒã¸ã®å¯¾ç­–

## ğŸ“Œ æ³¨æ„ç‚¹

- æœ¬å®Ÿè£…ã¯ç ”ç©¶ãƒ»ãƒ‡ãƒ¢ç›®çš„ã§ã‚ã‚Šã€å®Œå…¨ãªæš—å·åŒ–æ–¹å¼ã¨ã—ã¦ä¿è¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“
- ãƒ©ãƒ³ãƒ€ãƒ æºã¯ç’°å¢ƒã«ä¾å­˜ã™ã‚‹ãŸã‚ã€å®Ÿé‹ç”¨ç’°å¢ƒã§é©åˆ‡ãªã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æºã‚’ç¢ºä¿ã—ã¦ãã ã•ã„

## ğŸ‘¥ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ

å®Ÿè£…æ‹…å½“: ãƒ‘ã‚·å­
ãƒ†ã‚¹ãƒˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼: æš—å·åŒ–ãƒãƒ¼ãƒ 
