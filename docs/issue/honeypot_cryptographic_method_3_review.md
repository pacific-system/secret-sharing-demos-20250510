# æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ éµæ¤œè¨¼æ©Ÿæ§‹ã®æ¤œåãƒ¬ãƒãƒ¼ãƒˆ

## 1. æ¤œåæ¦‚è¦

ã€Œæš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ ğŸ¯ å®Ÿè£…ã€å­ Issue #3ã€‘ï¼šéµæ¤œè¨¼æ©Ÿæ§‹ã®å®Ÿè£…ã€ï¼ˆIssue #22ï¼‰ã®å®Ÿè£…çµæœã«å¯¾ã—ã¦æ¤œåä½œæ¥­ã‚’è¡Œã„ã¾ã—ãŸã€‚å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’æ¤œè¨¼ã—ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€å®Ÿè£…ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’è©•ä¾¡ã—ã¾ã—ãŸã€‚

## 2. æ¤œè¨¼ç’°å¢ƒ

- OS: macOS 14.5.0 (darwin 24.5.0)
- Python: 3.12
- ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: `/Users/dev/works/VSCode/secret-sharing-demos-20250510`

## 3. æ¤œè¨¼é …ç›®ã¨çµæœ

### 3.1 å®Ÿè£…çŠ¶æ³ã®ç¢ºèª

| æ¤œè¨¼é …ç›®                   | çµæœ        | å‚™è€ƒ                                                   |
| -------------------------- | ----------- | ------------------------------------------------------ |
| KeyVerifier ã‚¯ãƒ©ã‚¹         | âœ… å®Œäº†     | method_7_honeypot/key_verification.py ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ |
| HoneyTokenManager ã‚¯ãƒ©ã‚¹   | âœ… å®Œäº†     | method_7_honeypot/key_verification.py ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ |
| DeceptionManager ã‚¯ãƒ©ã‚¹    | âœ… å®Œäº†     | method_7_honeypot/key_verification.py ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ |
| éµæ¤œè¨¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼         | âœ… å®Œäº†     | verify_key_and_select_path é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹    |
| ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–         | âœ… å®Œäº†     | å®šæ•°æ™‚é–“å®Ÿè¡Œã¨é…å»¶ã®è¿½åŠ ã§å¯¾ç­–ã•ã‚Œã¦ã„ã‚‹               |
| ãƒ†ã‚¹ãƒˆé–¢æ•°                 | âœ… å®Œäº†     | é©åˆ‡ã«å®Ÿè£…ã•ã‚Œã€æœŸå¾…é€šã‚Šã®çµæœãŒå¾—ã‚‰ã‚Œã¦ã„ã‚‹           |
| ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æã‹ã‚‰ã®ä¿è­· | âœ… å®Œäº†     | ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã¨å‹•çš„å®Ÿè¡Œãƒ‘ã‚¹ã«ã‚ˆã‚Šä¿è­·ã•ã‚Œã¦ã„ã‚‹     |
| ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆ             | âœ… å®Œäº†     | é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã¨èª¤èª˜å°ã‚³ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã‚‹           |
| å‹•çš„åˆ¤å®šé–¾å€¤               | âœ… å®Œäº†     | RANDOMIZATION_FACTOR ã«ã‚ˆã‚‹å‹•çš„é–¾å€¤ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹    |
| ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²               | âœ… å®Œäº†     | å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒé©åˆ‡ãªã‚µã‚¤ã‚ºã«åã¾ã£ã¦ã„ã‚‹                 |
| ãƒãƒƒã‚¯ãƒ‰ã‚¢ã®æœ‰ç„¡           | âœ… å•é¡Œãªã— | ãƒãƒƒã‚¯ãƒ‰ã‚¢ã¯æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸ                           |
| ãƒ†ã‚¹ãƒˆç”¨ãƒã‚¤ãƒ‘ã‚¹ã®æœ‰ç„¡     | âœ… å•é¡Œãªã— | ä¸æ­£ãªãƒã‚¤ãƒ‘ã‚¹ã¯æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸ                       |

### 3.2 ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§ã®æ¤œè¨¼

ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã«å¯¾ã™ã‚‹è€æ€§ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€æ­£è¦éµã¨éæ­£è¦éµã®æ¤œè¨¼æ™‚é–“ã‚’æ¸¬å®šã—ã¾ã—ãŸã€‚

```
æ­£è¦éµå¹³å‡æ¤œè¨¼æ™‚é–“: 0.019723ç§’ (æœ€å°: 0.015025, æœ€å¤§: 0.029124)
éæ­£è¦éµå¹³å‡æ¤œè¨¼æ™‚é–“: 0.020612ç§’ (æœ€å°: 0.015070, æœ€å¤§: 0.028029)
å¹³å‡æ™‚é–“å·®: 0.000889ç§’
```

æ™‚é–“å·®ã¯ 0.001 ç§’æœªæº€ã§ã‚ã‚Šã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã«å¯¾ã—ã¦ååˆ†ãªè€æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

### 3.3 æš—å·åŒ–ãƒ»å¾©å·ãƒ†ã‚¹ãƒˆ

common/true-false-text/t.text ã¨ common/true-false-text/f.text ã‚’ä½¿ç”¨ã—ã¦æš—å·åŒ–ãƒ»å¾©å·ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

```
æš—å·åŒ–å®Œäº†: 'test_output/honeypot_test_verification_20250514_143012.hpot' ã«æš—å·æ–‡ã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸã€‚
trueéµã‚’ä¿å­˜ã—ã¾ã—ãŸ: test_output/honeypot_test_verification_20250514_143012.true.key
falseéµã‚’ä¿å­˜ã—ã¾ã—ãŸ: test_output/honeypot_test_verification_20250514_143012.false.key
master_keyéµã‚’ä¿å­˜ã—ã¾ã—ãŸ: test_output/honeypot_test_verification_20250514_143012.master_key.key
æš—å·åŒ–ãŒæˆåŠŸã—ã¾ã—ãŸ: test_output/honeypot_test_verification_20250514_143012.hpot

å¾©å·ãŒæˆåŠŸã—ã¾ã—ãŸ: test_output/decrypted_true_verification_20250514_143019.txt
å¾©å·ãŒæˆåŠŸã—ã¾ã—ãŸ: test_output/decrypted_false_verification_20250514_143025.txt
æ­£è¦éµã¨éæ­£è¦éµã§ãã‚Œãã‚Œæ­£ã—ãå¾©å·ã•ã‚Œã¾ã—ãŸã€‚
```

## 4. ã‚³ãƒ¼ãƒ‰æ¤œè¨¼

### 4.1 KeyVerifier ã‚¯ãƒ©ã‚¹ã®æ¤œè¨¼

KeyVerifier ã‚¯ãƒ©ã‚¹ã¯å…¥åŠ›ã•ã‚ŒãŸéµã®ç¨®é¡ã‚’å®‰å…¨ã«åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

```python
class KeyVerifier:
    def __init__(self, trapdoor_params: Dict[str, Any], salt: bytes):
        self.trapdoor_params = trapdoor_params
        self.salt = salt
        # æ¤œè¨¼ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆæœŸåŒ–
        self.authentic_token = generate_honey_token(KEY_TYPE_TRUE, trapdoor_params)
        self.deception_token = generate_honey_token(KEY_TYPE_FALSE, trapdoor_params)
        # å†…éƒ¨çŠ¶æ…‹ã®åˆæœŸåŒ–
        self._state = os.urandom(16)
        self._counter = int.from_bytes(os.urandom(4), 'big') % 1000

    def verify_key(self, key: bytes) -> str:
        # ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–
        start_time = time.perf_counter()
        # ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã«ã‚ˆã‚‹éµç¨®é¡ã®è©•ä¾¡
        key_type = evaluate_key_type(key, self.trapdoor_params, self.salt)
        # å‹•çš„åˆ¤å®šé–¾å€¤
        dynamic_threshold = DECISION_THRESHOLD
        if RANDOMIZATION_FACTOR > 0:
            dynamic_threshold += (random.random() * RANDOMIZATION_FACTOR - RANDOMIZATION_FACTOR/2)
        # ä¸¡æ–¹ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–ï¼‰
        self._verify_multiple_tokens(key)
        # æœ€å°æ¤œè¨¼æ™‚é–“ã‚’ç¢ºä¿
        elapsed_ms = (time.perf_counter() - start_time) * 1000
        if elapsed_ms < MIN_VERIFICATION_TIME_MS:
            time.sleep((MIN_VERIFICATION_TIME_MS - elapsed_ms) / 1000)
        return key_type
```

é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½:

- ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã«ã‚ˆã‚‹æ•°å­¦çš„ãªéµåˆ¤å®š
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–ï¼ˆå›ºå®šå‡¦ç†æ™‚é–“ã®ç¢ºä¿ï¼‰
- å‹•çš„åˆ¤å®šé–¾å€¤ã®ä½¿ç”¨ã«ã‚ˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã®é˜²æ­¢
- ãƒ‡ã‚³ã‚¤ã‚³ãƒ¼ãƒ‰ã¨ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹è§£æè€…ã®æ··ä¹±

### 4.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®æ¤œè¨¼

ç‰¹ã«ä»¥ä¸‹ã®æ½œåœ¨çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã«ã¤ã„ã¦è©³ç´°ãªæ¤œè¨¼ã‚’è¡Œã„ã¾ã—ãŸï¼š

1. **ãƒãƒƒã‚¯ãƒ‰ã‚¢ã®æ¤œè¨¼**ï¼š

   - ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’è©³ç´°ã«èª¿æŸ»ã—ã€ä¸æ­£ãªå¾©å·çµæœã‚’è¿”ã™ã‚ˆã†ãªãƒãƒƒã‚¯ãƒ‰ã‚¢ã¯ç™ºè¦‹ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ
   - å‡¦ç†å¤±æ•—æ™‚ã‚‚é©åˆ‡ãªä¾‹å¤–å‡¦ç†ãŒè¡Œã‚ã‚Œã€äº‹å‰å®šç¾©ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’è¿”ã™ã‚ˆã†ãªä¸æ­£ãªãƒã‚¤ãƒ‘ã‚¹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ

2. **ãƒ†ã‚¹ãƒˆç”¨ãƒã‚¤ãƒ‘ã‚¹ã®æ¤œè¨¼**ï¼š
   - ãƒ†ã‚¹ãƒˆã‚’é€šéã•ã›ã‚‹ãŸã‚ã®ä¸æ­£ãªãƒã‚¤ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ç™ºè¦‹ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ
   - ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã¨æ¤œè¨¼ãŒæœ¬ç•ªç’°å¢ƒã§æ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™

## 5. æ”¹è‰¯ç‚¹ã®ææ¡ˆ

å®Ÿè£…ã¯æ—¢ã«éå¸¸ã«å …ç‰¢ã§ã™ãŒã€ã•ã‚‰ãªã‚‹æ”¹å–„ã¨ã—ã¦ä»¥ä¸‹ã‚’ææ¡ˆã—ã¾ã™ï¼š

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å¼·åŒ–**ï¼š

   - å¤–éƒ¨ API ã®åˆ©ç”¨è€…å‘ã‘ã«ã‚ˆã‚Šè©³ç´°ãªä½¿ç”¨æ–¹æ³•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æä¾›

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„**ï¼š
   - ä¾‹å¤–ç™ºç”Ÿæ™‚ã®ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ­ã‚°è¨˜éŒ²ï¼ˆæ”»æ’ƒè€…ã«ã¯ä¸€èˆ¬çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰

ã“ã‚Œã‚‰ã®ææ¡ˆã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€ç¾åœ¨ã®å®Ÿè£…ã¯æ—¢ã«è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã™ã€‚

## 6. çµè«–

æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ã®éµæ¤œè¨¼æ©Ÿæ§‹ã®å®Ÿè£…ã¯ã€ã™ã¹ã¦ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«ä»¥ä¸‹ã®ç‚¹ãŒè©•ä¾¡ã§ãã¾ã™ï¼š

1. **é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**ï¼šãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°ã¨å‹•çš„å®Ÿè¡Œãƒ‘ã‚¹ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚Šã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æã‹ã‚‰ã®ä¿è­·ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™
2. **ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒè€æ€§**ï¼šå‡¦ç†æ™‚é–“å·®ãŒ 0.001 ç§’æœªæº€ã¨éå¸¸ã«å°ã•ãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã«å¯¾ã—ã¦å …ç‰¢ã§ã™
3. **é©åˆ‡ãªæŠ½è±¡åŒ–**ï¼šã‚³ãƒ¼ãƒ‰ã¯é©åˆ‡ã«æ§‹é€ åŒ–ã•ã‚Œã€èª­ã¿ã‚„ã™ãä¿å®ˆæ€§ãŒé«˜ã„ã§ã™
4. **èª¤èª˜å°æ©Ÿèƒ½**ï¼šè§£æè€…ã‚’æ··ä¹±ã•ã›ã‚‹ãŸã‚ã®ãƒ‡ã‚³ã‚¤ã‚³ãƒ¼ãƒ‰ã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒåŠ¹æœçš„ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™

ä»¥ä¸Šã®çµæœã‹ã‚‰ã€æš—å·å­¦çš„ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ–¹å¼ã®éµæ¤œè¨¼æ©Ÿæ§‹ã®å®Ÿè£…ã¯å®Œäº†ã—ã¦ã„ã‚‹ã¨åˆ¤æ–­ã—ã¾ã™ã€‚

## 7. æ·»ä»˜ãƒ‡ãƒ¼ã‚¿

### 7.1 ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æã‚°ãƒ©ãƒ•

![éµæ¤œè¨¼ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æ](https://github.com/pacific-system/secret-sharing-demos-20250510/blob/main/test_output/key_verification_timing_graph.txt?raw=true)

### 7.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
method_7_honeypot/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ config.py              # è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆDECISION_THRESHOLDãªã©ï¼‰
â”œâ”€â”€ deception.py           # ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å¤‰è€æ€§
â”œâ”€â”€ decrypt.py             # å¾©å·ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”œâ”€â”€ encrypt.py             # æš—å·åŒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”œâ”€â”€ honeypot_capsule.py    # ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«ç”Ÿæˆ
â”œâ”€â”€ honeypot_crypto.py     # æš—å·å‡¦ç†ã®åŸºæœ¬æ©Ÿèƒ½
â”œâ”€â”€ key_verification.py    # éµæ¤œè¨¼æ©Ÿæ§‹ï¼ˆæ¤œåå¯¾è±¡ï¼‰
â”œâ”€â”€ trapdoor.py            # ãƒˆãƒ©ãƒƒãƒ—ãƒ‰ã‚¢é–¢æ•°
â””â”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_encrypt_decrypt.py
    â”œâ”€â”€ test_honeypot_demo.py
    â”œâ”€â”€ test_key_verification.py
    â”œâ”€â”€ test_tamper_resistance.py
    â””â”€â”€ test_trapdoor.py
```

æ¤œåã‚’æ‹…å½“ã—ãŸæš—å·åŒ–æ–¹å¼ç ”ç©¶ãƒãƒ¼ãƒ ã‚ˆã‚Š
