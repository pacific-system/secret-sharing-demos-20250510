# シャミア秘密分散法による複数平文復号システム テスト仕様書

## 1. テスト目的

シャミア秘密分散法による複数平文復号システムの実装が、仕様通りに動作することを検証するためのテストフレームワークを提供します。このテストは、セキュリティ要件と機能要件の両方を検証します。

## 2. テスト規約

### 2.1 テスト実行規約

- テスト完了後、`/method_13_shamir_multi_plaintext_system/IMPLEMENTATION_NOTES.md` のフォーマットに準じたレポートを `/method_13_shamir_multi_plaintext_system/tests/test_report` ディレクトリに生成する
- テストはメインモジュールからレポートに必要なコンポーネントを読み込んで実行する
- 毎回のテスト実行ではレポート項目の全てをテストする
- テストに採用する値は `/method_13_shamir_multi_plaintext_system/shamir/constants.py` のみを使用する

### 2.2 テストレポート命名規則

テストレポートのファイル名は以下の形式とする：

```
test_report_{YYYYMMDD}_{HHMMSS}.md
```

例：`test_report_20250510_123045.md`

## 3. テスト範囲

### 3.1 機能テスト

以下の機能を検証する：

1. 暗号書庫生成（createCryptoStorage）

   - パーティション分割
   - パーティションマップキー生成
   - ガベージシェア配置
   - 第 1 段階 MAP 生成

2. 暗号書庫更新（updateCryptoStorage）

   - 多段エンコード
   - シャミア法シェア生成
   - 第 2 段階 MAP 生成
   - シェア配置
   - バックアップ処理

3. 暗号書庫読取（readCryptoStorage）
   - シェア選択
   - シャミア法復元
   - 多段デコード
   - JSON 復元

### 3.2 統合テスト

以下の統合テストを実施する：

1. A 領域書込・読取テスト
2. B 領域書込・読取テスト
3. A/B 独立性検証テスト
4. 大容量データテスト
5. 障害復旧テスト

### 3.3 セキュリティテスト

以下のセキュリティ特性を検証する：

1. 統計的区別不可能性検証
2. タイミング攻撃耐性
3. パターン認識耐性
4. 異常入力耐性

## 4. テスト環境・条件

各テスト実行時に以下の条件を満たしていることを確認する：

- PARTITION_SIZE: シャミア法パーティションのサイズ
- ACTIVE_SHARES: アクティブシェアの数
- GARBAGE_SHARES: ガベージシェアの数
- UNASSIGNED_SHARES: 未割当シェアの数
- CHUNK_SIZE: チャンクサイズ (バイト)
- BACKUP_RETENTION_DAYS: バックアップ保持日数
- ハッシュアルゴリズム: 使用するハッシュアルゴリズム
- 暗号化アルゴリズム: 使用する暗号化アルゴリズム

## 5. テスト実行方法

テスト実行は以下のコマンドにより行われる：

```bash
cd /path/to/secret-sharing-demos-20250510/method_13_shamir_multi_plaintext_system
python -m tests.test_runner
```

## 6. 期待される結果

全てのテストが成功し、以下の条件を満たすこと：

1. 異なるパーティション間でデータが漏洩しないこと
2. ガベージシェアと有効シェアが統計的に区別できないこと
3. パーティションキーとパスワードが正しい場合のみ、復号が成功すること
4. 複数文書の管理と独立した復号化が正常に機能すること
5. テストレポートが期待通りに生成されること

## 7. 追加情報

テスト実行時に生成されたデータやログは、テストケースの終了後に適切に削除されます。ただし、障害検出時やデバッグ目的のために、一部のデータが `test_report` ディレクトリに保存される場合があります。
